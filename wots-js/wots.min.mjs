function sha256(r){function t(r,t){return r>>>t|r<<32-t}for(var n,o,e=Math.pow,a=e(2,32),_=[],s=8*r.length,u=sha256.h=sha256.h||[],h=sha256.k=sha256.k||[],S=h.length,i={},A=2;S<64;A++)if(!i[A]){for(n=0;n<313;n+=A)i[n]=A;u[S]=e(A,.5)*a|0,h[S++]=e(A,1/3)*a|0}for(r+="Â€";r.length%64-56;)r+="\0";for(n=0;n<r.length;n++){if((o=r.charCodeAt(n))>>8)return;_[n>>2]|=o<<(3-n)%4*8}for(_[_.length]=s/a|0,_[_.length]=s,o=0;o<_.length;){var f=_.slice(o,o+=16),c=u;for(u=u.slice(0,8),n=0;n<64;n++){var y=f[n-15],l=f[n-2],p=u[0],d=u[4],N=u[7]+(t(d,6)^t(d,11)^t(d,25))+(d&u[5]^~d&u[6])+h[n]+(f[n]=n<16?f[n]:f[n-16]+(t(y,7)^t(y,18)^y>>>3)+f[n-7]+(t(l,17)^t(l,19)^l>>>10)|0);(u=[N+((t(p,2)^t(p,13)^t(p,22))+(p&u[1]^p&u[2]^u[1]&u[2]))|0].concat(u))[4]=u[4]+N|0}for(n=0;n<8;n++)u[n]=u[n]+c[n]|0}var g=[];for(n=0;n<8;n++)for(o=3;o+1;o--){var W=u[n]>>8*o&255;g.push(W),W.toString(16)}return g}function bArr_toString(r){for(var t="",n=0;n<r.length;n++)t+=String.fromCharCode(r[n]);return t}Array.prototype.toASCII=function(){for(var r="",t=0;t<this.length;t++)r+=String.fromCharCode(this[t]);return r},String.prototype.toBytes=function(){for(var r=[],t=0;t<this.length;t++)r.push(this.charCodeAt(t));return r},Array.prototype.pushArray=function(r){this.push.apply(this,r)};var PARAMSN=32,WOTSW=16,WOTSLOGW=4,WOTSLEN1=8*PARAMSN/WOTSLOGW,WOTSLEN2=3,WOTSLEN=WOTSLEN1+WOTSLEN2,WOTSSIGBYTES=WOTSLEN*PARAMSN,TXSIGLEN=2144,TXADDRLEN=2208,XMSS_HASH_PADDING_F=0,XMSS_HASH_PADDING_PRF=3;function wots_public_key_gen(r,t,n){for(var o=bytes_to_addr(n),e=expand_seed(r),a=[],_=0;_<WOTSLEN;_++){set_chain_addr(_,o);var s=gen_chain(e.slice(_*PARAMSN,PARAMSN+_*PARAMSN),0,WOTSW-1,t,o);a.pushArray(s)}return a}function wots_sign(r,t,n,o){var e=bytes_to_addr(o),a=[],_=[];a=chain_lenghts(r),console.log("lenghts"),console.log(a.length),console.log(a.toString());for(var s=expand_seed(t),u=0;u<WOTSLEN;u++){set_chain_addr(u,e);var h=gen_chain(s.slice(u*PARAMSN,PARAMSN+u*PARAMSN),0,a[u],n,e);_.pushArray(h)}return _}function wots_publickey_from_sig(r,t,n,o){var e,a=bytes_to_addr(o);e=chain_lenghts(t);for(var _=[],s=0;s<WOTSLEN;s++){set_chain_addr(s,a);var u=r.slice(s*PARAMSN,PARAMSN+s*PARAMSN);_.pushArray(gen_chain(u,e[s],WOTSW-1-e[s],n,a))}return _}function expand_seed(r){for(var t=[],n=[],o=0;o<WOTSLEN;o++)t=ull_to_bytes(PARAMSN,[o]),n.pushArray(prf(t,r));return n}function ull_to_bytes(r,t){for(var n=[],o=r-1;o>=0;o--){var e=t[o];null==e?n.push(0):n.push(e)}return n}function prf(r,t){var n=[];n=ull_to_bytes(PARAMSN,[XMSS_HASH_PADDING_PRF]);var o=byte_copy(t,PARAMSN);n.pushArray(o);var e=byte_copy(r,32);return n.pushArray(e),sha256(n.toASCII())}function t_hash(r,t,n){var o=[];o=ull_to_bytes(PARAMSN,[XMSS_HASH_PADDING_F]);set_key_and_mask(0,n);var e=prf(addr_to_bytes(n),t);o.pushArray(e),set_key_and_mask(1,n);for(var a=prf(addr_to_bytes(n),t),_=[],s=0;s<PARAMSN;s++)_.push(r[s]^a[s]);return o.pushArray(_),sha256(o.toASCII())}function byte_copy(r,t){for(var n=[],o=0;o<t;o++)null==r[o]?n.push(0):n.push(r[o]);return n}function gen_chain(r,t,n,o,e){for(var a=byte_copy(r,PARAMSN),_=t;_<t+n&&_<WOTSW;_++)set_hash_addr(_,e),a=t_hash(a,o,e);return a}function base_w(r,t){for(var n,o=0,e=0,a=0,_=[],s=0;s<r;s++)0==a&&(n=t[o],o++,a+=8),a-=WOTSLOGW,_[e]=n>>a&WOTSW-1,e++;return _}function wots_checksum(r){for(var t,n=0,o=0;o<WOTSLEN1;o++)n+=WOTSW-1-r[o];return n<<=8-WOTSLEN2*WOTSLOGW%8,t=ull_to_bytes(Math.round((WOTSLEN2*WOTSLOGW+7)/8),from_int_to_byte_array(n)),base_w(WOTSLEN2,t)}function chain_lenghts(r){var t=base_w(WOTSLEN1,r);return t.pushArray(wots_checksum(t)),t}function set_chain_addr(r,t){t[5]=[0,0,0,r]}function set_hash_addr(r,t){t[6]=[0,0,0,r]}function set_key_and_mask(r,t){t[7]=[0,0,0,r]}function from_int_to_byte_array(r){var t=[];for(0==r&&t.push(r);0!=r;)t.push(255&r),r>>=8;return t}function addr_to_bytes(r){for(var t=[],n=0;n<8;n++){null==r[n.toString()]&&(r[n.toString()]=[0,0,0,0]);var o=r[n.toString()];t.pushArray(o)}return t}function bytes_to_addr(r){for(var t={0:[0,0,0,0],1:[0,0,0,0],2:[0,0,0,0],3:[0,0,0,0],4:[0,0,0,0],5:[0,0,0,0],6:[0,0,0,0],7:[0,0,0,0]},n=0;n<8;n++)t[n.toString()]=ull_to_bytes(4,r.slice(4*n,4*n+4));return t}export{sha256,wots_sign,wots_public_key_gen,wots_publickey_from_sig,ull_to_bytes,from_int_to_byte_array,byte_copy};
